<!DOCTYPE html>
<html lang="pt-PT" dir="ltr" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title> Eventos FCT NOVA</title>
    <link rel="stylesheet" href="styleMainPage.css">
    <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-storage.js"></script>
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body onload="loadLoggedUser()">
<button onclick="queryEvents();" id="moreList">Mais <i class='bx bx-list-plus'></i></button>
<button onclick="topFunction()" id="myBtn">Topo <i class='bx bx-up-arrow-alt'></i></button>
<button onclick="bottomFunction();" id="myBtnDown">Baixo <i class='bx bx-down-arrow-alt'></i></button>
<div class="sidebar">
    <div class="logo-details">
        <i> <img src="../img/logo.png" alt="UNIVERSE logo" width="45" height="45"> </i>
        <span class="logo_name">UniVerse</span>
    </div>
    <ul class="nav-links">
        <li>
            <button onclick="window.location.href = '/backoffice/mainPage.html'">
                <a href="#">
                    <i class='bx bx-grid-alt' ></i>
                    <span class="links_name">Home</span>
                </a>
            </button>
        </li>
        <li>
            <button onclick="window.location.href = '/backoffice/mainPageNews.html'">
                <a href="#news">
                    <i class='bx bx-message'></i>
                    <span class="links_name">Notícias</span>
                </a>
            </button>
        </li>
        <li>
            <button onclick="window.location.href = '/backoffice/mainPageEvents.html'">
                <a href="#events" class="active">
                    <i class='bx bx-list-ul' ></i>
                    <span class="links_name">Eventos</span>
                </a>
            </button>
        </li>
        <li>
            <button onclick="window.location.href = '/backoffice/mainPageUsers.html'">
                <a href="#users">
                    <i class='bx bx-user' ></i>
                    <span class="links_name">Users</span>
                </a>
            </button>
        </li>
        <li>
            <button onclick="window.location.href = '/backoffice/mainPageNucleos.html'">
                <a href="#stats">
                    <i class='bx bx-pie-chart-alt-2' ></i>
                    <span class="links_name">Núcleos</span>
                </a>
            </button>
        </li>
        <li>
            <button onclick="window.location.href = '/backoffice/mainPageReports.html'">
                <a href="#reposts">
                    <i class='bx bx-book-alt' ></i>
                    <span class="links_name">Reports</span>
                </a>
            </button>
        </li>
        <li>
            <button onclick="window.location.href = '/backoffice/mainPageDepartamentos.html'">
                <a href="#dpt">
                    <i class='bx bx-buildings' ></i>
                    <span class="links_name">Departamentos</span>
                </a>
            </button>
        </li>
        <li class="log_out">
            <button onclick="openPopup()">
                <a href="#logout">
                    <i class='bx bx-log-out'></i>
                    <span class="links_name">Log out</span>
                </a>
            </button>
        </li>
    </ul>
</div>
<section class="home-section">
    <nav>
        <div class="sidebar-button">
            <i class='bx bx-menu sidebarBtn'></i>
            <span class="home">Eventos</span>
        </div>
        <h1> Back Office da FCT NOVA</h1>
        <div class="profile-details" id="auxLogged">
            <img src="img/logo.png" alt="">
            <span class="admin_name" id="name"></span>
        </div>
    </nav>

    <div class="home-content">
        <div class="topnav" id="myTopnav">
            <button id="postBtn" onClick="changeWindow('postBtn', 'validateBtn', 'editBtn', 'deleteBtn', 'queryBtn', 'eventAdd', 'eventValidate', 'eventMod', 'eventDel', 'eventList'); auxListMore(0);" class="active">Adicionar Evento</button>
            <button id="editBtn"  onClick="changeWindow('editBtn', 'validateBtn', 'postBtn', 'deleteBtn', 'queryBtn', 'eventMod', 'eventValidate', 'eventAdd', 'eventDel', 'eventList'); auxListMore(0);">Modificar Evento</button>
            <button id="validateBtn" onClick="changeWindow('validateBtn','queryBtn', 'postBtn', 'editBtn', 'deleteBtn', 'eventValidate', 'eventList', 'eventAdd', 'eventMod', 'eventDel'); auxListMore(0);">Validar Evento</button>
            <button id="deleteBtn" onClick="changeWindow('deleteBtn', 'validateBtn', 'postBtn', 'editBtn', 'queryBtn', 'eventDel', 'eventValidate', 'eventAdd', 'eventMod', 'eventList'); auxListMore(0);">Apagar Evento</button>
            <button id="queryBtn" onClick="changeWindow('queryBtn', 'validateBtn', 'postBtn', 'editBtn', 'deleteBtn', 'eventList', 'eventValidate', 'eventAdd', 'eventMod', 'eventDel'); auxListMore(1);">Listar Eventos</button>
        </div>
        <br><br>
        <div id="eventAdd">
            <div class="form">
                <div class="title">Evento</div>
                <div class="subtitle">Vamos criar um novo evento!</div>
                <div class="input-container ic1">
                    <input id="title" class="input" type="text" placeholder=" "/>
                    <div class="cut"></div>
                    <label for="title" class="placeholder">Título do Evento</label>
                </div>
                <div class="input-container ic2">
                    <input id="startDate" class="input" type="text" placeholder=" "/>
                    <div class="cut"></div>
                    <label for="startDate" class="placeholder">Data de Início</label>
                </div>
                <div class="input-container ic2">
                    <input id="endDate" class="input" type="text" placeholder=" "/>
                    <div class="cut cut"></div>
                    <label for="endDate" class="placeholder">Data de Fim</label>
                </div>
                <div class="input-container ic2">
                    <input id="location" class="input" type="text" placeholder=" "/>
                    <div class="cut cut"></div>
                    <label for="location" class="placeholder">Localização</label>
                </div>
                <div class="input-container ic2">
                    <input id="department" class="input" type="text" placeholder=" "/>
                    <div class="cut cut"></div>
                    <label for="department" class="placeholder">Departamento</label>
                </div> <br>
                <input type="file" id="eventPic" accept="image/*">
                <button onclick="uploadEventPic()">Upload</button>                <br>
                <div style="text-align: center;">
                    <img src="" alt="Event Picture" class="eventPhoto">
                </div>
                <div class="subtitle" style="margin-left: 10px; padding: 20px 0px; text-align: center;">
                    <label for="title">Capacidade máxima do Evento: &emsp;</label>
                    <input type ="text" style="width: 50%; border-radius: 5px; text-align: center;" id = "capacity" name="eventCapacity" >
                </div>
                <div class="subtitle" style="margin-left: 10px; text-align: center;">
                    <label for="isPublic">Evento público? &emsp;</label>
                    <select style="height:30px; width: 100px; border-radius: 10px; text-align: center;" id="isPublic">
                        <option value="no">Não</option>
                        <option value="yes">Sim</option>
                    </select>&emsp;&emsp;
                    <label for="isItPaid">Evento a pagar? &emsp;</label>
                    <select style="height:30px; width: 100px; border-radius: 10px; text-align: center;" id="isItPaid">
                        <option value="no">Não</option>
                        <option value="yes">Sim</option>
                    </select>
                </div>
                <button type="text" class="submit" onclick="postEvent()">Adicionar Evento</button>
            </div>
            <br><br>
        </div>
        <div id="eventMod" style="display: none;">
            <div class="form">
                <div class="title">Modificar Evento</div>
                <div class="subtitle">Vamos obter um evento e modificá-lo</div>
                <div class="input-container ic1">
                    <input id="idEventMod" class="input" type="text" placeholder=" "/>
                    <div class="cut"></div>
                    <label for="title" class="placeholder">Id do Evento</label>
                </div>
                <button type="text" class="submit" onclick="getEvent()">Obter Evento</button>
            </div>
            <br>
            <div class="form">
                <div class="input-container ic1">
                    <input id="titleMod" class="input" type="text" placeholder=" "/>
                    <div class="cut"></div>
                    <label id="titleModeLbl" for="title" class="placeholder">Título do Evento</label>
                </div>
                <div class="input-container ic2">
                    <input id="startDateMod" class="input" type="text" placeholder=" " />
                    <div class="cut"></div>
                    <label id="startDateModLbl" for="startDate" class="placeholder">Data de Início</label>
                </div>
                <div class="input-container ic2">
                    <input id="endDateMod" class="input" type="text" placeholder=" " />
                    <div class="cut cut"></div>
                    <label id="endDateModLbl" for="endDate" class="placeholder">Data de Fim</label>
                </div>
                <div class="input-container ic2">
                    <input id="locationMod" class="input" type="text" placeholder=" " />
                    <div class="cut cut"></div>
                    <label id="locationModLbl" for="location" class="placeholder">Localização</label>
                </div>
                <div class="input-container ic2">
                    <input id="departmentMod" class="input" type="text" placeholder=" " />
                    <div class="cut cut"></div>
                    <label id="departmentModLbl" for="department" class="placeholder">Departamento</label>
                </div><br>
                <div class="subtitle" style="margin-left: 10px;">Imagem do Evento &emsp;<input style="width: 70%; height: 38px;" class="input" type="file" id="eventPicMod" accept="image/*" onchange="updateEventPicMod()"></div>
                <br>
                <div style="text-align: center;">
                    <img src="" alt="Event Picture" class="eventPhoto">
                </div>
                <div class="subtitle" style="margin-left: 10px; padding: 20px 0px; text-align: center;">
                    <label id="capacityLbl" for="title">Capacidade máxima do Evento</label>
                    <input type ="text" style="width: 50%; border-radius: 5px; text-align: center;" id = "capacityMod" name="eventCapacity" >
                </div>
                <div class="subtitle" style="margin-left: 10px; text-align: center;">
                    <label id="isPublicLbl" for="isPublic">Evento público? &emsp;</label>
                    <select style="height:30px; width: 100px; border-radius: 10px; text-align: center;" id="isPublicMod">
                        <option value=""></option>
                        <option value="no">Não</option>
                        <option value="yes">Sim</option>
                    </select>&emsp;&emsp;
                    <label id="isItPaidLbl" for="isItPaid">Evento a pagar? &emsp;</label>
                    <select style="height:30px; width: 100px; border-radius: 10px; text-align: center;" id="isItPaidMod">
                        <option value=""></option>
                        <option value="no">Não</option>
                        <option value="yes">Sim</option>
                    </select>
                </div>
                <button type="text" class="submit" onclick="editEvent()">Mudar Evento</button>
            </div>
            <br><br>
        </div>
        <div id="eventDel" style="display: none;">
            <div class="form">
                <div class="title">Apagar Evento</div>
                <div class="subtitle">Vamos apagar o evento com base no Identificador (ID)</div>
                <div class="input-container ic1">
                    <input id="idEventDelete" class="input" type="text" placeholder=" "/>
                    <div class="cut"></div>
                    <label for="title" class="placeholder">Id do Evento</label>
                </div>
                <button type="text" class="submit" onclick="deleteEvent()">Apagar Evento</button>
            </div>
            <br><br>
        </div>
        <div id="eventValidate" style="display: none;">
            <div class="form">
                <div class="title">Validar Evento</div>
                <div class="subtitle">Vamos validar um evento específico!</div>
                <div class="input-container ic1">
                    <input id="idEventValidate" class="input" type="text" placeholder=" "/>
                    <div class="cut"></div>
                    <label for="title" class="placeholder">Id do Evento</label>
                </div>
                <button type="text" class="submit" onclick="validateEvent()">Validar Evento</button>
            </div>
            <br><br>
        </div>
        <div id="eventList" class="list" style="display: none;">
            <h1 class="title" style="text-align: center;">Listar Eventos</h1>
            <br>
            <div style="justify-content: center;">
                <h2 class="subtitle" for="listLimitId" style="display: inline;">Eventos por listagem: &emsp;</h2>
                <select id="listLimitId" style="width: 80px; display: inline;">
                    <option value=5>5</option>
                    <option value=10>10</option>
                    <option value=15>15</option>
                    <option value=20>20</option>
                </select>
                <br><br>
                <label>
                    <p class="subtitle" style="display: inline;">Filtrar entre </p>
                    <input id="dateStart" style="background-color: #303245; color: #eee; text-align: center; height: 35px;" type="date"/>
                    <p class="subtitle" style="display: inline;"> (Data Inicial) &emsp; e </p> &emsp;
                    <input id="dateEnd" style="background-color: #303245; color: #eee; text-align: center; height: 35px;" type="date"/>
                    <p class="subtitle" style="display: inline;"> (Data Final) &emsp;</p>
                </label>
                <div style="text-align: right;"> <button class="submit" style="background-color: #303245; width: 200px; color: #eee; margin-top: 10px; height: 35px;" onclick="clearListEvents('listOfEvents', 'details');">Apagar Lista</button></div>
            </div>

            <ul id="listOfEvents"> </ul>
            <hr class="rounded">
            <br>
            <div id="details"></div>
            <br>
            <button class="submit" onclick="sortDates(dateStart.value, dateEnd.value);">Listar</button>
        </div>
        <br><br>
        <div class="popup" id="popup">
            <h3>Está prestes a fazer logout</h3>
            <p>Tem a certeza?</p>
            <button type="button" onclick="logout()">Sim</button> &ensp;
            <button type="button" onclick="closePopup()">Não</button>
        </div>
    </div>
    <div class="popup" id="loadingPopup">
        <div class="loading-icon"></div>
        <br>
        <h3>A carregar...</h3>
    </div>
</section>

<script src="/js/functions.js"></script>
<script src="/js/functions2.js"></script>
<script>
      let loading = document.getElementById("loadingPopup");

        var firebaseConfig = {
            apiKey: "AIzaSyB8lbZJXbOkWNkgRxvzqwhLtgGQf5GmpS4",
          authDomain: "universe-fct.firebaseapp.com",
          databaseURL: "https://universe-fct-default-rtdb.europe-west1.firebasedatabase.app",
          projectId: "universe-fct",
          storageBucket: "gs://universe-fct.appspot.com",
          messagingSenderId: "493010584500",
          appId: "1:493010584500:web:9c958f30725cd60533a8e1",
          measurementId: "G-XB1FHSZ4M0"
          };
            // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

      function loadingPopupOn(){
           loading.classList.add("openLoadingPopup");
      }

      function loadingPopupOff(){
           loading.classList.remove("openLoadingPopup");
      }

      function changeWindow(btn, btn1, btn2, btn3, btn4, div, div1, div2, div3, div4){
        var appear = document.getElementById(div);
        var gone = document.getElementById(div1);
        var gone2 = document.getElementById(div2);
        var gone3 = document.getElementById(div3);
        var gone4 = document.getElementById(div4);
        var button = document.getElementById(btn);
        var button2 = document.getElementById(btn1);
        var button3 = document.getElementById(btn2);
        var button4 = document.getElementById(btn3);
        var button5 = document.getElementById(btn4);

        appear.style.display = 'block';
        gone.style.display = 'none';
        gone2.style.display = 'none';
        gone3.style.display = 'none';
        gone4.style.display = 'none';
        button.classList.add("active");
        button2.classList.remove("active");
        button3.classList.remove("active");
        button4.classList.remove("active");
        button5.classList.remove("active");
      }

      let popup = document.getElementById("popup");

      function openPopup(){
        popup.classList.add("open-popup");
      }

      function closePopup(){
        popup.classList.remove("open-popup");
      }

      let sidebar = document.querySelector(".sidebar");
      let sidebarBtn = document.querySelector(".sidebarBtn");
      sidebarBtn.onclick = function() {
      sidebar.classList.toggle("active");
      if(sidebar.classList.contains("active")){
        sidebarBtn.classList.replace("bx-menu" ,"bx-menu-alt-right");
      }else
        sidebarBtn.classList.replace("bx-menu-alt-right", "bx-menu");
      }

      let mybutton = document.getElementById("myBtn");
      let mybuttondwn = document.getElementById("myBtnDown");
      let myList = document.getElementById("moreList");
      let varAux = 0;
      window.onscroll = function() {scrollFunction()};

      function auxListMore(nr){
        varAux = nr;
      }

      function scrollFunction() {
        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            mybutton.style.display = "block";
            mybuttondwn.style.display = "block";
            if(varAux == 1){
                myList.style.display = "block";
            }
        } else {
            mybutton.style.display = "none";
            myList.style.display = "none";
            mybuttondwn.style.display = "none";
        }
      }

      function topFunction() {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
      }

      function bottomFunction() {
        window.scrollTo(0,document.body.scrollHeight);
        topPage.style.display = '';
      }

      function formatDate() {
        var x = document.getElementById("dateStart").value;
        x = new Date(x);
        x.setHours(x.getHours() - x.getHours());
        return x;
      }

      function formatDate2() {
        var x2 = document.getElementById("dateEnd").value;
        x2 = new Date(x2);
        x2.setHours(x2.getHours() - x2.getHours());
        x2.setMinutes(x2.getMinutes() - x2.getMinutes());
        x2.setSeconds(x2.getSeconds() - x2.getSeconds());
        x2.setHours(23);
        x2.setMinutes(59);
        x2.setSeconds(59);
        return x2;
      }

      function clearList(){
        var r1 = document.getElementById("listOfEvents");
        var r2 = document.getElementById("details");
        r1.replaceChildren();
        r2.replaceChildren();
      }

      function sortDates(d1, d2){
        if((d1 == '') && (d2 == '')){
            queryEvents();
            return;
        }
        else if( (d1 != '') && (d2 == '')){
            d1 = d1.concat('T13%3A00%3A00.192Z');
            d2 = '3000-12-31T22%3A59%3A59.252Z';
        }
        else if( (d1 == '') && (d2 != '')){
            d1 = '1000-12-31T22%3A59%3A59.252Z';
            d2 = d2.concat('T22%3A59%3A59.252Z');
        }
        else if(d2 < d1) {
            alert('A data inicial tem de ser antes da data final');
        }
        else{
            d1 = d1.concat('T13%3A00%3A00.192Z');
            d2 = d2.concat('T22%3A59%3A59.252Z');
        }
        queryEventsWithDates(d1,d2);
      }

       function uploadEventPic() {
    var file = document.getElementById("eventPic").files[0];
    var storageRef = firebase.storage().ref();
    var eventPicRef = storageRef.child("Eventos/" + file.name);

    eventPicRef.put(file).then(function(snapshot) {
      console.log("Event picture uploaded successfully!");
    }).catch(function(error) {
      console.error("Error uploading event picture:", error);
    });
  }

    function updateEventPic() {
        let selectedFile = document.getElementById("eventPic").files[0];
        if(selectedFile.size > 8500000){
            alert('Ficheiro demasiado pesado (máximo de 8 MB)');
            document.getElementById("eventPic").value = "";
        }
        else{
            document.getElementsByClassName("eventPhoto")[0].src = URL.createObjectURL(selectedFile);
        }
    }

    function updateEventPicMod() {
        let selectedFile2 = document.getElementById("eventPicMod").files[0];
        if(selectedFile2.size > 8500000){
            alert('Ficheiro demasiado pesado (máximo de 8 MB)');
            document.getElementById("eventPicMod").value = "";
        }
        else{
            document.getElementsByClassName("eventPhoto")[0].src = URL.createObjectURL(selectedFile);
        }
    }
</script>

</body>
</html>